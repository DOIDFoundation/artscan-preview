import{w as J,Z as M,a as E,d as K,e as X,T as $,N as Y,i as N,u as S,f as W,h as L,s as ee,j as P,k as T,l as te,D as se,g as ie,n as oe}from"./index-e13c8d95.js";import{y as a,m as l,e as x,x as re,z as ne,j as O,n as f,l as I,k as c,u as A,d as ae}from"./vendor-c8c15b27.js";const le=s=>{const{id:e,tokenURI:t}=s,[o,i]=e?e.toString().split("-"):[s.contract.id,s.tokenID];return{address:o,tokenID:i,slugID:i,ctime:s.createdAt*1e3,tokenURI:t}},ce=s=>{const e=le(s),{owner:{id:t="",doids:o=[]}={}}=s;return Object.assign(e,{owner:t,doids:o.map(i=>({...i,name:J(i.name)}))})},Be=async s=>{const e=s.toLowerCase();let t=0,o=0;if(s!=M){const i=await E("scan",`{
        owner(id:"${e}") {mints:totalTokensMinted,holders:totalTokenHolders}
      }`),{holders:r=[],mints:n=[]}=i.owner;t=r,o=n}return{ownerNum:t,mintNum:o}},q=async(s,e={pageSize:5,page:1})=>{let{minter:t,doid:o,tokenID:i}=s;if(!t||t==M)return[];t=t.toLowerCase();const{tokens:r=[]}=await E("scan",`{tokens(${K(e)} where:{${X({minter:t,tokenID:i})}} orderBy:createdAt orderDirection:desc){
        id tokenURI createdAt owner { id doids { name }
      }}}`)||{};return r.map(n=>Object.assign(ce(n),{minter:t,doid:o}))},Te=async s=>(await q(s))[0];var he=Object.defineProperty,de=Object.getOwnPropertyDescriptor,H=(s,e,t,o)=>{for(var i=o>1?void 0:o?de(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&he(e,t,i),i};let j=class extends $(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return a`<div class="block mx-auto my-8 text-center text-base"><i class="mdi mdi-loading mx-1"></i></div>`;default:return a`<i class="mdi mdi-loading mr-1"></i> Loading...`}}};H([l({type:String})],j.prototype,"type",2);j=H([x("loading-icon")],j);const B=(s,{persistent:e=!1}={})=>class extends s{constructor(){super(...arguments),this.onObserved=()=>{},this.unobserve=()=>{var t;return this.observe$&&((t=this.observer)==null?void 0:t.unobserve(this.observe$))},this.observe=()=>{this.observer||(this.observe$||(this.observe$=this.$(":first-child")))&&(this.observer=new IntersectionObserver(t=>{t[0].intersectionRatio<=0||(this.onObserved(),e||this.unobserve())}),this.observer.observe(this.observe$))}}firstUpdated(){this.observe()}connectedCallback(){this.unobserve(),super.connectedCallback()}},pe={url:{"0x1":"https://opensea.io/assets/ethereum","0xaa36a7":"https://testnets.opensea.io/assets/sepolia","0x5":"https://testnets.opensea.io/assets/goerli"},api:{"0x1":"https://api.opensea.io/api/v1/asset","0xaa36a7":"https://testnets-api.opensea.io/api/v1/asset","0x5":"https://testnets-api.opensea.io/api/v1/asset"}},ge=s=>pe[s][Y.chainId],me=s=>{s=s.toLowerCase();var e=[];for(let i=0;i<s.length;i++){var t=s.charCodeAt(i);t>=32&&t<=47||t>=58&&t<=64||t==91||t>=93&&t<=96||t>=123?e.push(" "):e.push(s.charAt(i))}s=e.join("").trim(),e=[];var o=!1;for(let i=0;i<s.length;i++){let r=s.charAt(i);r==" "||r=="	"||r=="\r"||r==`
`||r=="\v"||r=="\f"?(o||e.push("-"),o=!0):(e.push(r),o=!1)}return e.join("")},U=s=>{var h;const{background_color:e,owner:t="",external_link:o,asset_contract:i,collection:r}=s,n=s.image_url||s.image||"",v=s.name||(r==null?void 0:r.name);return{name:v,description:s.description||(r==null?void 0:r.description),slug:me(v),image:P(s.image_preview_url||s.image_thumbnail_url||n),raw:P(s.image_original_url||n),creator:(h=s.creator)==null?void 0:h.address,owner:t,external_link:o,background_color:e}},z={store:sessionStorage,withoutEnv:!0,ttl:864e5};let k=0;const Z=async(s,e=1024)=>{let t={};if(k)return await te(50),await Z(s);k=T();try{t=await L.get(s),setTimeout(()=>{k=0},Math.max(T()-k,e))}catch(o){k=0}return t},ue=async({address:s="",tokenID:e=""}={})=>{let t;const o=await S(`meta.${s}.${e}`,z);if(t=await o.get(),!t)try{t=U(await Z(`${ge("api")}/${s}/${e}/`)),t&&o.set(t)}catch(i){}return t!=null?t:{}},R=async(s="")=>{let e;if(!s)return{};N(s)&&(e=U(await L.get(s)));const t=await S(`meta.${s}`,z);if(e||(e=await t.get()),!e)try{e=U(await L.get(P(s))),e&&t.set(e)}catch(o){}return e!=null?e:{}},fe=async s=>{let e;const{tokenURI:t,address:o,tokenID:i,doid:r,minter:n}=s;if(N(t)&&(e=await R(t)),!e&&t&&(e=await(await S(`meta.${t}`,z)).get()),e||(e=await(await S(`meta.${o}.${i}`,z)).get()),!e&&o&&i&&(e=await ue(s)),!e&&t&&(e=await R(t)),e&&r)try{const v=await W(),d=await L.get(`https://raw.githubusercontent.com/DOIDFoundation/artscan-slugs/main/${v}/${ee(r)}/${e.slug}.txt`);e.sync=d.includes(o)}catch(v){}return e!=null?e:{}},ye=async(s,{maxW:e=400}={})=>new Promise(t=>{if(!s)return t("");const o=sessionStorage.getItem(`blob.${s}`);if(o)return t(o);const i=new Image;i.src=s,i.crossOrigin="anonymous",i.onload=async()=>{let[d,h]=[i.width,i.height],[F,Q,V,G]=[0,0,d,h];d>e&&(h=e*(h/d),d=e),h>e&&(d=e*(d/h),h=e),i.height/i.width,r.width=d,r.height=h,n.drawImage(i,F,Q,V,G,0,0,d,h),v()};const r=document.createElement("canvas"),n=r.getContext("2d"),v=()=>{r.toBlob(d=>{const h=URL.createObjectURL(d);sessionStorage.setItem(`blob.${s}`,h),t(h)},"image/png",1)}}),be=`i{position:relative;display:inline-flex;height:100%;width:100%;align-items:center;justify-content:center;overflow:hidden}i.empty,i.err,i:not(.loaded){background:linear-gradient(-45deg,rgba(238,201,121) 8%,rgb(187,131,68) 36%,rgba(238,201,121) 66%) 0% 0% / 2400px;animation:silk 4s linear infinite}i.err img{visibility:hidden}i img{height:auto;max-height:100%;width:auto;max-width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-object-fit:contain;object-fit:contain}@keyframes silk{0%{background-position:-2400px 0}to{background-position:2400px 0}}
`;var ve=Object.defineProperty,we=Object.getOwnPropertyDescriptor,g=(s,e,t,o)=>{for(var i=o>1?void 0:o?we(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&ve(e,t,i),i};const $e=[48,64,128,256,384,512,640,750,828,1080,1200,1920,2048,3840];let p=class extends B($(be)){constructor(){super(...arguments),this.el$=re(),this.src="",this.loaded=!1,this.stop=!1,this.loading="eager",this.sizes=void 0,this.w="100%",this.firstLoaded=this.loaded,this.imgLoaded=this.loaded,this.err=!1,this.show=!1,this.blobSrc="",this.onLoad=()=>{this.emit("loaded",this.imgLoaded=this.firstLoaded=!0)},this.onError=()=>{this.err=!1},this.onObserved=()=>{var s,e;this.w=((e=(s=this.el$.value)==null?void 0:s.getBoundingClientRect().width)!=null?e:"400")+"",this.show=!0}}get lazy(){return this.loading==="lazy"}get isInstantSrc(){return N(this.src)}get isResizableSrc(){return/\?(w|width)=/.test(this.src)}get requireComporess(){return!this.isResizableSrc&&!this.isInstantSrc&&!this.blobSrc}get uri(){if(!(this.err||!this.show))return this.requireComporess?this.blobSrc:this.src}get empty(){return!(this.src||this.blobSrc)||!(this.uri||this.uriset)}get uriset(){if(this.err||!this.show||!this.isResizableSrc)return;const{origin:s,pathname:e}=new URL(this.src);return $e.map(t=>`${[s+e]}?auto=format&w=${t}&width=${t} ${t}w`).join(",")}get autoSizes(){return this.sizes?this.sizes:`(max-width: 768px) ${this.w}px, ${this.w}px`}shouldUpdate(s){return s.has("src")&&this.requireComporess&&ye(this.src).then(e=>this.blobSrc=e),!0}connectedCallback(){super.connectedCallback(),this.loading==="eager"&&this.onObserved()}render(){return a`<i ${ne(this.el$)} class="${O({loaded:this.firstLoaded,err:this.err,empty:this.empty,stop:this.stop})}">${f(this.isResizableSrc?this.uriset:this.uri,()=>a`<img class="${O({invisible:!this.firstLoaded,"opacity-0":!this.firstLoaded})}" src="${I(this.uri)}" srcset="${I(this.uriset)}" sizes="${I(this.autoSizes)}" @load="${this.onLoad}" @error="${this.onError}">`)}</i>`}};g([l({type:String})],p.prototype,"src",2);g([l({type:Boolean})],p.prototype,"loaded",2);g([l({type:Boolean})],p.prototype,"stop",2);g([l({type:String})],p.prototype,"loading",2);g([l({type:String})],p.prototype,"sizes",2);g([c()],p.prototype,"w",2);g([c()],p.prototype,"firstLoaded",2);g([c()],p.prototype,"imgLoaded",2);g([c()],p.prototype,"err",2);g([c()],p.prototype,"show",2);g([c()],p.prototype,"blobSrc",2);p=g([x("img-loader")],p);const xe=`.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}
`;var ke=Object.defineProperty,Oe=Object.getOwnPropertyDescriptor,C=(s,e,t,o)=>{for(var i=o>1?void 0:o?Oe(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&ke(e,t,i),i};let _=class extends $(xe){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?a`<slot></slot>`:a`<div class="skeleton ${O(this.$c([this.class]))}">${A(this.groups,()=>a`<div class="p"></div>`)}</div>`}};C([l({type:Boolean})],_.prototype,"expect",2);C([l({type:Number})],_.prototype,"num",2);C([l({type:String})],_.prototype,"class",2);_=C([x("loading-skeleton")],_);const _e=`.item{min-height:11rem}
`;var De=Object.defineProperty,Se=Object.getOwnPropertyDescriptor,D=(s,e,t,o)=>{for(var i=o>1?void 0:o?Se(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&De(e,t,i),i};let w=class extends B($(_e)){constructor(){super(...arguments),this.item={},this.meta={},this.cook=async()=>{this.meta=await fe(this.item),this.cooked=await se({DOIDName:this.doid,token:this.token})},this.onObserved=()=>{this.cook()},this.goto=()=>{this.cookedUri&&ie(`/collection/${this.cookedUri}`)}}get doid(){var e;return(e=this.DOID)==null?void 0:e.doid}get createTime(){return this.item.ctime?new Date(this.item.ctime).toLocaleString():""}get token(){var o;const{tokenID:e,slugID:t}=this.item;return{name:(o=this.meta)==null?void 0:o.name,tokenID:e,slugID:t}}get cookedName(){var e,t;return(t=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:t.val}get cookedUri(){var e,t;return(t=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:t.uri}get tokenName(){var e,t;return(t=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:t.val}connectedCallback(){super.connectedCallback()}render(){var e,t,o;return a`<div class="item p-4"><div class="font-medium"><loading-skeleton .expect="${this.tokenName}"><dui-link class="uri" href="${`/collection/${this.cookedUri}`}">${this.cookedUri}</dui-link></loading-skeleton></div><div class="flex gap-4 py-4"><img-loader class="shrink-0 w-24 h-24" .src="${(e=this.meta)==null?void 0:e.image}" loading="lazy"></img-loader><div><loading-skeleton .expect="${this.meta.name}" num="3"><div class="mb-2 flex items-center"><b class="inline-block text-white rounded py-0.5 px-1 text-xs mr-1.5 ${O({"bg-green-600":!!this.meta.sync,"bg-gray-500":!this.meta.sync})}">${this.meta.sync?"Verified":"Unverified"}</b><dui-link class="text-base" href="${`/collection/${this.cookedUri}`}">${this.meta.name}<i class="mdi mdi-ethereum ml-1"></i></dui-link></div><p class="break-words break-all text-xs lg_text-sm text-gray-500">${(t=this.meta)==null?void 0:t.description}</p></loading-skeleton></div></div><div class="text-xs">Minted on ${this.createTime}, Owned by ${f((o=this.item.doids)==null?void 0:o.length,()=>{var i,r;return a`${(r=(i=this.item.doids)==null?void 0:i.at(0))==null?void 0:r.name}`},()=>a`<dui-address .address="${this.item.owner}"></dui-address>`)}</div></div>`}};D([l()],w.prototype,"DOID",2);D([l()],w.prototype,"item",2);D([c()],w.prototype,"cooked",2);D([c()],w.prototype,"meta",2);w=D([x("doid-coll-item")],w);const Le=`:host::part(inner){display:flex;height:2rem;width:100%;align-items:center;justify-content:center}@media (min-width: 1024px){:host::part(inner){height:2.5rem}}
`;var ze=Object.defineProperty,Ce=Object.getOwnPropertyDescriptor,y=(s,e,t,o)=>{for(var i=o>1?void 0:o?Ce(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&ze(e,t,i),i};let m=class extends B($(Le),{persistent:!0}){constructor(){super(...arguments),this.pageSize=5,this.page=1,this.mode="scroll",this.pending=!1,this.firstLoad=!0,this.empty=!1,this.nomore=!1,this.class="",this.onObserved=()=>{this.scrollMode&&this.loadmore()}}get canLoad(){return!this.pending&&!this.nomore&&!this.empty&&!this.firstLoad}get scrollMode(){return this.mode==="scroll"}loadmore(){if(!this.canLoad)return;const{pageSize:s,page:e,mode:t}=this;this.emit("loadmore",{pageSize:s,page:e,mode:t})}connectedCallback(){super.connectedCallback()}render(){return a`<div class="dui-pagination w-full flex justify-center items-center mt-4 ${O(this.$c([{nomore:this.nomore,"pointer-events-none":!this.canLoad},this.class]))}"><div part="inner" @click="${this.loadmore}">${f(this.empty,()=>a`<slot name="empty"></slot>`,()=>a`${f(this.nomore,()=>a`<slot name="nomore"></slot>`,()=>a`${f(this.pending,()=>a`<slot name="loading"><loading-icon type="block"></loading-icon></slot>`,()=>a`${f(!this.scrollMode&&!this.firstLoad,()=>a`<slot><dui-link>Load more</dui-link></slot>`)}`)}`)}`)}</div></div>`}};y([l({type:Number})],m.prototype,"pageSize",2);y([l({type:Number})],m.prototype,"page",2);y([l()],m.prototype,"mode",2);y([l()],m.prototype,"pending",2);y([l({type:Boolean})],m.prototype,"firstLoad",2);y([l({type:Boolean})],m.prototype,"empty",2);y([l({type:Boolean})],m.prototype,"nomore",2);y([l()],m.prototype,"class",2);m=y([x("dui-pagination")],m);const Ie="";var Pe=Object.defineProperty,je=Object.getOwnPropertyDescriptor,b=(s,e,t,o)=>{for(var i=o>1?void 0:o?je(e,t):e,r=s.length-1,n;r>=0;r--)(n=s[r])&&(i=(o?n(e,t,i):n(i))||i);return o&&i&&Pe(e,t,i),i};let u=class extends $(Ie){constructor(){super(...arguments),this.pending=!1,this.err="",this.ts=0,this.collections=[],this.nomore=!1,this.page=1,this.pageSize=5,this.loadmore=()=>{this.page++,this.getCollections()}}get doid(){var s;return(s=this.DOID)==null?void 0:s.doid}get empty(){return!this.err&&!!this.doid&&!!this.ts&&!this.collections.length}get pagination(){return{page:this.page,pageSize:this.pageSize}}async getCollections(){if(this.pending)return;const{owner:s=""}=await oe(this.doid);if(s){this.pending=!0,this.err="";try{const e=await q({minter:s,doid:this.doid},this.pagination);this.collections.push(...e),this.nomore=e.length<this.pageSize}catch(e){this.err=e.message||e}finally{this.ts++,this.pending=!1}}}connectedCallback(){super.connectedCallback(),this.getCollections()}render(){return a`<div class="doid-collections">${f(this.err,()=>a`${this.err}`)} ${f(this.collections.length,()=>a`<div class="grid gap-4">${A(this.collections,s=>a`${ae(s,a`<div class="bg-gray-100 mb-1 break-words break-all rounded-md"><doid-coll-item .DOID="${this.DOID}" .item="${s}"></doid-coll-item></div>`)}`)}</div>`)} ${f(!this.err,()=>a`<dui-pagination .pending="${this.pending}" .nomore="${this.nomore}" .firstLoad="${!this.ts}" .empty="${this.empty}" .pageSize="${this.pageSize}" .page="${this.page}" @loadmore="${this.loadmore}"><span slot="empty">No collection yet.</span></dui-pagination>`)}</div>`}};b([l()],u.prototype,"DOID",2);b([c()],u.prototype,"pending",2);b([c()],u.prototype,"err",2);b([c()],u.prototype,"ts",2);b([c()],u.prototype,"collections",2);b([c()],u.prototype,"nomore",2);b([c()],u.prototype,"page",2);b([c()],u.prototype,"pageSize",2);u=b([x("doid-collections")],u);export{ge as a,Te as b,fe as g,Be as q};
