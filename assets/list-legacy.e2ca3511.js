System.register(["./index-legacy.8460688d.js","./vendor-legacy.5567aa4d.js"],(function(e,t){"use strict";var i,s,o,r,n,a,d,c,l,h,p,g,m,u,y,b,k,v,w,$,f,x,O,D,L,S;return{setters:[e=>{i=e.a,s=e.s,o=e.Z,r=e.d,n=e.e,a=e.T,d=e.N,c=e.u,l=e.f,h=e.h,p=e.i,g=e.j,m=e.k,u=e.l,y=e.m,b=e.D,k=e.g,v=e.n},e=>{w=e.y,$=e.m,f=e.e,x=e.j,O=e.n,D=e.k,L=e.u,S=e.d}],execute:function(){const t=(e="")=>async t=>{const o=await i(e)||"";return await s(o,t)},j=(e("q",(async e=>{const i=e.toLowerCase();let s=0,r=0;if(e!=o){const e=await t()(`{\n        owner(id:"${i}") {mints:totalTokensMinted,holders:totalTokenHolders}\n      }`),{holders:o=[],mints:n=[]}=e.owner;s=o,r=n}return{ownerNum:s,mintNum:r}})),async(e,i={pageSize:5,page:1})=>{const{minter:s,doid:a}=e;if(s==o)return[];const{tokens:d=[]}=await t()((({minter:e="",tokenID:t=""}={},i)=>{const s={minter:e=e.toLowerCase(),tokenID:t};return`{\n    tokens(${r(i)} where:{${n(s)}} orderBy:createdAt orderDirection:desc){\n      id tokenURI createdAt owner { id doids { name } }\n    }\n  }`})(e,i))||{};return d.map((e=>Object.assign((e=>{const t=(e=>{const{id:t,tokenURI:i}=e,[s,o]=t?t.toString().split("-"):[e.contract.id,e.tokenID];return{address:s,tokenID:o,ctime:1e3*e.createdAt,tokenURI:i}})(e),{owner:{id:i="",doids:s=[]}={}}=e;return Object.assign(t,{owner:i,doids:s})})(e),{minter:s,doid:a})))});e("b",(async e=>(await j(e))[0]));var I=Object.defineProperty,C=Object.getOwnPropertyDescriptor,z=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?C(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&I(t,i,r),r};let U=class extends(a("")){constructor(){super(...arguments),this.type="inline"}render(){return"block"===this.type?w`<div class="block mx-auto my-8 text-center text-base"><i class="mdi mdi-loading mx-1"></i></div>`:w`<i class="mdi mdi-loading mr-1"></i> Loading...`}};z([$({type:String})],U.prototype,"type",2),U=z([f("loading-icon")],U);const P=(e,{persistent:t=!1}={})=>class extends e{constructor(){super(...arguments),this.onObserved=()=>{},this.unobserve=()=>this.observe$&&this.observer?.unobserve(this.observe$),this.observe=()=>{this.observer||(this.observe$||(this.observe$=this.$(":first-child")))&&(this.observer=new IntersectionObserver((e=>{e[0].intersectionRatio<=0||(this.onObserved(),t||this.unobserve())})),this.observer.observe(this.observe$))}}firstUpdated(){this.observe()}connectedCallback(){this.unobserve(),super.connectedCallback()}},_={url:{"0x1":"https://opensea.io/assets/ethereum","0xaa36a7":"https://testnets.opensea.io/assets/sepolia","0x5":"https://testnets.opensea.io/assets/goerli"},api:{"0x1":"https://api.opensea.io/api/v1/asset","0xaa36a7":"https://testnets-api.opensea.io/api/v1/asset","0x5":"https://testnets-api.opensea.io/api/v1/asset"}},N=e("a",(e=>_[e][d.chainId])),R=e=>{const{background_color:t,owner:i="",external_link:s,asset_contract:o,collection:r}=e,n=e.image_url||e.image||"",a=e.name||r?.name;return{name:a,description:e.description||r?.description,slug:m(a),image:g(e.image_preview_url||e.image_thumbnail_url||n),raw:g(e.image_original_url||n),creator:e.creator?.address,owner:i,external_link:s,background_color:t}},q={store:sessionStorage,withoutEnv:!0,ttl:864e5};let B=0;const M=async e=>{let t={};if(B)return await y(50),await M(e);B=u();try{t=await h.get(e),setTimeout((()=>{B=0}),Math.max(u()-B,1024))}catch(i){B=0}return t},T=e("g",(async e=>{let t;const{tokenURI:i,address:s,tokenID:o,doid:r,minter:n}=e;if(i&&(t=await(await c(`meta.${i}`,q)).get()),t||(t=await(await c(`meta.${s}.${o}`,q)).get()),!t&&s&&o&&(t=await(async({address:e="",tokenID:t=""}={})=>{let i={};const s=await c(`meta.${e}.${t}`,q);if(i=await s.get(),i)return i;try{i=R(await M(`${N("api")}/${e}/${t}/`)),i.origin="opensea",i&&s.set(i)}catch($){}return i})(e)),t||(t=await(async(e="")=>{let t={};if(!e)return t;const i=await c(`meta.${e}`,q);if(t=await i.get(),t)return t;try{const s=g(e);t=R(await h.get(s)),t.origin="ipfs",t&&i.set(t)}catch($){}return t})(i)),r)try{const e=await l(),i=await h.get(`https://raw.githubusercontent.com/DOIDFoundation/doid-slugs/main/${e}/${p(r)}/${t.slug}.txt`);t.sync=i.includes(n)}catch(a){}return t??{}}));var A=Object.defineProperty,E=Object.getOwnPropertyDescriptor,F=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?E(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&A(t,i,r),r};let H=class extends(P(a("i{position:relative;display:inline-flex;height:100%;width:100%;align-items:center;justify-content:center;overflow:hidden}i.empty,i.err,i:not(.loaded){background:linear-gradient(-45deg,rgba(238,201,121) 8%,rgb(187,131,68) 36%,rgba(238,201,121) 66%) 0% 0% / 2400px;animation:silk 4s linear infinite}i.err img{visibility:hidden}i img{height:auto;max-height:100%;width:auto;max-width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-object-fit:contain;object-fit:contain}@keyframes silk{0%{background-position:-2400px 0}to{background-position:2400px 0}}\n"))){constructor(){super(...arguments),this.src="",this.loaded=!1,this.stop=!1,this.loading="eager",this.firstLoaded=this.loaded,this.imgLoaded=this.loaded,this.err=!1,this.show=!1,this.blobSrc="",this.onLoad=()=>{this.emit("loaded",this.imgLoaded=this.firstLoaded=!0)},this.onError=()=>{this.err=!1},this.onObserved=()=>{this.show=!0}}get lazy(){return"lazy"===this.loading}get requireComporess(){return this.src&&!/\?(w|width)=/.test(this.src)&&!this.blobSrc}get uri(){return!this.show||this.err?"":this.requireComporess?this.blobSrc:this.src}get empty(){return!this.src||!this.uri}shouldUpdate(e){return e.has("src")&&this.requireComporess&&(async(e,{maxW:t=380}={})=>new Promise((i=>{const s=new Image;s.src=e,s.crossOrigin="anonymous",s.onload=async()=>{let[e,i]=[s.width,s.height],[a,d,c,l]=[0,0,e,i];e>t&&(i=t*(i/e),e=t),i>t&&(e=t*(e/i),i=t),s.height,s.width,o.width=e,o.height=i,r.drawImage(s,a,d,c,l,0,0,e,i),n()};const o=document.createElement("canvas"),r=o.getContext("2d"),n=()=>{o.toBlob((e=>{const t=URL.createObjectURL(e);i(t)}),"image/png",1)}})))(this.src).then((e=>this.blobSrc=e)),!0}connectedCallback(){super.connectedCallback(),this.show="eager"===this.loading}render(){return w`<i class="${x({loaded:this.firstLoaded,err:this.err,empty:this.empty,stop:this.stop})}">${O(this.uri,(()=>w`<img class="${x({invisible:!this.firstLoaded,"opacity-0":!this.firstLoaded})}" src="${this.uri}" @load="${this.onLoad}" @error="${this.onError}">`))}</i>`}};F([$({type:String})],H.prototype,"src",2),F([$()],H.prototype,"loaded",2),F([$()],H.prototype,"stop",2),F([$({type:String})],H.prototype,"loading",2),F([D()],H.prototype,"firstLoaded",2),F([D()],H.prototype,"imgLoaded",2),F([D()],H.prototype,"err",2),F([D()],H.prototype,"show",2),F([D()],H.prototype,"blobSrc",2),H=F([f("img-loader")],H);var V=Object.defineProperty,W=Object.getOwnPropertyDescriptor,Z=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?W(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&V(t,i,r),r};let G=class extends(a('.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}\n')){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?w`<slot></slot>`:w`<div class="skeleton ${x(this.$c([this.class]))}">${L(this.groups,(()=>w`<div class="p"></div>`))}</div>`}};Z([$({type:Boolean})],G.prototype,"expect",2),Z([$({type:Number})],G.prototype,"num",2),Z([$({type:String})],G.prototype,"class",2),G=Z([f("loading-skeleton")],G);var J=Object.defineProperty,K=Object.getOwnPropertyDescriptor,Q=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?K(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&J(t,i,r),r};let X=class extends(P(a(".item{min-height:11rem}\n"))){constructor(){super(...arguments),this.item={},this.meta={},this.cook=async()=>{this.meta=await T(this.item),this.cooked=await b({DOIDName:this.doid,token:this.token})},this.onObserved=()=>{this.cook()},this.goto=()=>{this.cookedUri&&k(`/collection/${this.cookedUri}`)}}get doid(){return this.DOID?.doid}get createTime(){return this.item.ctime?new Date(this.item.ctime).toLocaleString():""}get token(){const{tokenID:e,sequence:t}=this.item;return{name:this.meta?.name,tokenID:e,sequence:t}}get cookedName(){return this.cooked?.parsed?.val}get cookedUri(){return this.cooked?.parsed?.uri}get tokenName(){return this.cooked?.parsed?.val}connectedCallback(){super.connectedCallback()}render(){return w`<div class="item p-4"><div class="font-medium"><loading-skeleton .expect="${this.tokenName}"><dui-link class="uri" href="${`/collection/${this.cookedUri}`}">${this.tokenName}</dui-link></loading-skeleton></div><div class="flex gap-4 py-4"><img-loader class="shrink-0 w-24 h-24" .src="${this.meta?.image}" loading="lazy"></img-loader><div><loading-skeleton .expect="${this.meta.name}" num="3"><div class="mb-2 flex items-center"><b class="inline-block text-white rounded py-0.5 px-1 text-xs mr-1.5 ${x({"bg-green-600":!!this.meta.sync,"bg-gray-500":!this.meta.sync})}">${this.meta.sync?"Verified":"Unverified"}</b><dui-link class="text-base" href="${`/collection/${this.cookedUri}`}">${this.meta.name}<i class="mdi mdi-ethereum ml-1"></i></dui-link></div><p class="break-words break-all text-xs lg_text-sm text-gray-500">${this.meta?.description}</p></loading-skeleton></div></div><div class="text-xs">Minted on ${this.createTime}, Owned by ${O(this.item.doids?.length,(()=>w`${this.item.doids?.at(0)?.name}.doid`),(()=>w`<dui-address .address="${this.item.owner}"></dui-address>`))}</div></div>`}};Q([$()],X.prototype,"DOID",2),Q([$()],X.prototype,"item",2),Q([D()],X.prototype,"cooked",2),Q([D()],X.prototype,"meta",2),X=Q([f("doid-coll-item")],X);var Y=Object.defineProperty,ee=Object.getOwnPropertyDescriptor,te=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?ee(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&Y(t,i,r),r};let ie=class extends(P(a(":host::part(inner){display:flex;height:2rem;width:100%;align-items:center;justify-content:center}@media (min-width: 1024px){:host::part(inner){height:2.5rem}}\n"),{persistent:!0})){constructor(){super(...arguments),this.pageSize=5,this.page=1,this.mode="scroll",this.pending=!1,this.firstLoad=!0,this.empty=!1,this.nomore=!1,this.class="",this.onObserved=()=>{this.scrollMode&&this.loadmore()}}get canLoad(){return!(this.pending||this.nomore||this.empty||this.firstLoad)}get scrollMode(){return"scroll"===this.mode}loadmore(){if(!this.canLoad)return;const{pageSize:e,page:t,mode:i}=this;this.emit("loadmore",{pageSize:e,page:t,mode:i})}connectedCallback(){super.connectedCallback()}render(){return w`<div class="dui-pagination w-full flex justify-center items-center mt-4 ${x(this.$c([{nomore:this.nomore,"pointer-events-none":!this.canLoad},this.class]))}"><div part="inner" @click="${this.loadmore}">${O(this.empty,(()=>w`<slot name="empty"></slot>`),(()=>w`${O(this.nomore,(()=>w`<slot name="nomore"></slot>`),(()=>w`${O(this.pending,(()=>w`<slot name="loading"><loading-icon type="block"></loading-icon></slot>`),(()=>w`${O(!this.scrollMode&&!this.firstLoad,(()=>w`<slot><dui-link>Load more</dui-link></slot>`))}`))}`))}`))}</div></div>`}};te([$({type:Number})],ie.prototype,"pageSize",2),te([$({type:Number})],ie.prototype,"page",2),te([$()],ie.prototype,"mode",2),te([$()],ie.prototype,"pending",2),te([$({type:Boolean})],ie.prototype,"firstLoad",2),te([$({type:Boolean})],ie.prototype,"empty",2),te([$({type:Boolean})],ie.prototype,"nomore",2),te([$()],ie.prototype,"class",2),ie=te([f("dui-pagination")],ie);var se=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,re=(e,t,i,s)=>{for(var o,r=s>1?void 0:s?oe(t,i):t,n=e.length-1;n>=0;n--)(o=e[n])&&(r=(s?o(t,i,r):o(r))||r);return s&&r&&se(t,i,r),r};let ne=class extends(a("")){constructor(){super(...arguments),this.pending=!1,this.err="",this.ts=0,this.collections=[],this.nomore=!1,this.page=1,this.pageSize=5,this.loadmore=()=>{this.page++,this.getCollections()}}get doid(){return this.DOID?.doid}get empty(){return!(this.err||!this.doid||!this.ts||this.collections.length)}get pagination(){return{page:this.page,pageSize:this.pageSize}}async getCollections(){if(this.pending)return;const{owner:e=""}=await v(this.doid);if(e){this.pending=!0,this.err="";try{const t=await j({minter:e,doid:this.doid},this.pagination);this.collections.push(...t),this.nomore=t.length<this.pageSize}catch(t){this.err=t.message||t}finally{this.ts++,this.pending=!1}}}connectedCallback(){super.connectedCallback(),this.getCollections()}render(){return w`<div class="doid-collections">${O(this.err,(()=>w`${this.err}`))} ${O(this.collections.length,(()=>w`<div class="grid gap-4">${L(this.collections,(e=>w`${S(e,w`<div class="bg-gray-100 mb-1 break-words break-all rounded-md"><doid-coll-item .DOID="${this.DOID}" .item="${e}"></doid-coll-item></div>`)}`))}</div>`))} ${O(!this.err,(()=>w`<dui-pagination .pending="${this.pending}" .nomore="${this.nomore}" .firstLoad="${!this.ts}" .empty="${this.empty}" .pageSize="${this.pageSize}" .page="${this.page}" @loadmore="${this.loadmore}"><span slot="empty">No collection yet.</span></dui-pagination>`))}</div>`}};re([$()],ne.prototype,"DOID",2),re([D()],ne.prototype,"pending",2),re([D()],ne.prototype,"err",2),re([D()],ne.prototype,"ts",2),re([D()],ne.prototype,"collections",2),re([D()],ne.prototype,"nomore",2),re([D()],ne.prototype,"page",2),re([D()],ne.prototype,"pageSize",2),ne=re([f("doid-collections")],ne)}}}));
