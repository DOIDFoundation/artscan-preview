import{a as Z,s as F,Z as N,d as G,e as V,T as w,N as J,u as C,f as K,h as j,i as X,j as S,k as Y,l as U,m as W,D as ee,g as te,n as se}from"./index-7273221b.js";import{y as a,m as c,e as $,j as x,n as y,k as d,u as T,d as ie}from"./vendor-c8c15b27.js";const M=(t="")=>async e=>{const s=await Z(t)||"";return await F(s,e)},oe=t=>{const{id:e,tokenURI:s}=t,[i,o]=e?e.toString().split("-"):[t.contract.id,t.tokenID];return{address:i,tokenID:o,ctime:t.createdAt*1e3,tokenURI:s}},re=t=>{const e=oe(t),{owner:{id:s="",doids:i=[]}={}}=t;return Object.assign(e,{owner:s,doids:i})},je=async t=>{const e=t.toLowerCase();let s=0,i=0;if(t!=N){const o=await M()(`{
        owner(id:"${e}") {mints:totalTokensMinted,holders:totalTokenHolders}
      }`),{holders:r=[],mints:n=[]}=o.owner;s=r,i=n}return{ownerNum:s,mintNum:i}},ne=({minter:t="",tokenID:e=""}={},s)=>{t=t.toLowerCase();const i={minter:t,tokenID:e};return`{
    tokens(${G(s)} where:{${V(i)}} orderBy:createdAt orderDirection:desc){
      id tokenURI createdAt owner { id doids { name } }
    }
  }`},B=async(t,e={pageSize:5,page:1})=>{const{minter:s,doid:i}=t;if(s==N)return[];const{tokens:o=[]}=await M()(ne(t,e))||{};return o.map(r=>Object.assign(re(r),{minter:s,doid:i}))},ze=async t=>(await B(t))[0];var ae=Object.defineProperty,ce=Object.getOwnPropertyDescriptor,E=(t,e,s,i)=>{for(var o=i>1?void 0:i?ce(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&ae(e,s,o),o};let I=class extends w(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return a`<div class="block mx-auto my-8 text-center text-base"><i class="mdi mdi-loading mx-1"></i></div>`;default:return a`<i class="mdi mdi-loading mr-1"></i> Loading...`}}};E([c({type:String})],I.prototype,"type",2);I=E([$("loading-icon")],I);const z=(t,{persistent:e=!1}={})=>class extends t{constructor(){super(...arguments),this.onObserved=()=>{},this.unobserve=()=>{var s;return this.observe$&&((s=this.observer)==null?void 0:s.unobserve(this.observe$))},this.observe=()=>{this.observer||(this.observe$||(this.observe$=this.$(":first-child")))&&(this.observer=new IntersectionObserver(s=>{s[0].intersectionRatio<=0||(this.onObserved(),e||this.unobserve())}),this.observer.observe(this.observe$))}}firstUpdated(){this.observe()}connectedCallback(){this.unobserve(),super.connectedCallback()}},le={url:{"0x1":"https://opensea.io/assets/ethereum","0xaa36a7":"https://testnets.opensea.io/assets/sepolia","0x5":"https://testnets.opensea.io/assets/goerli"},api:{"0x1":"https://api.opensea.io/api/v1/asset","0xaa36a7":"https://testnets-api.opensea.io/api/v1/asset","0x5":"https://testnets-api.opensea.io/api/v1/asset"}},de=t=>le[t][J.chainId],R=t=>{var D;const{background_color:e,owner:s="",external_link:i,asset_contract:o,collection:r}=t,n=t.image_url||t.image||"",l=t.name||(r==null?void 0:r.name);return{name:l,description:t.description||(r==null?void 0:r.description),slug:Y(l),image:S(t.image_preview_url||t.image_thumbnail_url||n),raw:S(t.image_original_url||n),creator:(D=t.creator)==null?void 0:D.address,owner:s,external_link:i,background_color:e}},L={store:sessionStorage,withoutEnv:!0,ttl:864e5};let k=0;const q=async t=>{let e={};if(k)return await W(50),await q(t);k=U();try{e=await j.get(t),setTimeout(()=>{k=0},Math.max(U()-k,1024))}catch(s){k=0}return e},he=async({address:t="",tokenID:e=""}={})=>{let s={};const i=await C(`meta.${t}.${e}`,L);if(s=await i.get(),s)return s;try{s=R(await q(`${de("api")}/${t}/${e}/`)),s.origin="opensea",s&&i.set(s)}catch(o){}return s},pe=async(t="")=>{let e={};if(!t)return e;const s=await C(`meta.${t}`,L);if(e=await s.get(),e)return e;try{const i=S(t);e=R(await j.get(i)),e.origin="ipfs",e&&s.set(e)}catch(i){}return e},ge=async t=>{let e;const{tokenURI:s,address:i,tokenID:o,doid:r,minter:n}=t;if(s&&(e=await(await C(`meta.${s}`,L)).get()),e||(e=await(await C(`meta.${i}.${o}`,L)).get()),!e&&i&&o&&(e=await he(t)),e||(e=await pe(s)),r)try{const l=await K(),h=await j.get(`https://raw.githubusercontent.com/DOIDFoundation/doid-slugs/main/${l}/${X(r)}/${e.slug}.txt`);e.sync=h.includes(n)}catch(l){}return e!=null?e:{}},me=async(t,{maxW:e=380}={})=>new Promise(s=>{const i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=async()=>{let[l,h]=[i.width,i.height],[D,A,Q,H]=[0,0,l,h];l>e&&(h=e*(h/l),l=e),h>e&&(l=e*(l/h),h=e),i.height/i.width,o.width=l,o.height=h,r.drawImage(i,D,A,Q,H,0,0,l,h),n()};const o=document.createElement("canvas"),r=o.getContext("2d"),n=()=>{o.toBlob(l=>{const h=URL.createObjectURL(l);s(h)},"image/png",1)}}),ue=`i{position:relative;display:inline-flex;height:100%;width:100%;align-items:center;justify-content:center;overflow:hidden}i.empty,i.err,i:not(.loaded){background:linear-gradient(-45deg,rgba(238,201,121) 8%,rgb(187,131,68) 36%,rgba(238,201,121) 66%) 0% 0% / 2400px;animation:silk 4s linear infinite}i.err img{visibility:hidden}i img{height:auto;max-height:100%;width:auto;max-width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-object-fit:contain;object-fit:contain}@keyframes silk{0%{background-position:-2400px 0}to{background-position:2400px 0}}
`;var ye=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,u=(t,e,s,i)=>{for(var o=i>1?void 0:i?fe(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&ye(e,s,o),o};let p=class extends z(w(ue)){constructor(){super(...arguments),this.src="",this.loaded=!1,this.stop=!1,this.loading="eager",this.firstLoaded=this.loaded,this.imgLoaded=this.loaded,this.err=!1,this.show=!1,this.blobSrc="",this.onLoad=()=>{this.emit("loaded",this.imgLoaded=this.firstLoaded=!0)},this.onError=()=>{this.err=!1},this.onObserved=()=>{this.show=!0}}get lazy(){return this.loading==="lazy"}get requireComporess(){return this.src&&!/\?(w|width)=/.test(this.src)&&!this.blobSrc}get uri(){return!this.show||this.err?"":this.requireComporess?this.blobSrc:this.src}get empty(){return!this.src||!this.uri}shouldUpdate(t){return t.has("src")&&this.requireComporess&&me(this.src).then(e=>this.blobSrc=e),!0}connectedCallback(){super.connectedCallback(),this.show=this.loading==="eager"}render(){return a`<i class="${x({loaded:this.firstLoaded,err:this.err,empty:this.empty,stop:this.stop})}">${y(this.uri,()=>a`<img class="${x({invisible:!this.firstLoaded,"opacity-0":!this.firstLoaded})}" src="${this.uri}" @load="${this.onLoad}" @error="${this.onError}">`)}</i>`}};u([c({type:String})],p.prototype,"src",2);u([c()],p.prototype,"loaded",2);u([c()],p.prototype,"stop",2);u([c({type:String})],p.prototype,"loading",2);u([d()],p.prototype,"firstLoaded",2);u([d()],p.prototype,"imgLoaded",2);u([d()],p.prototype,"err",2);u([d()],p.prototype,"show",2);u([d()],p.prototype,"blobSrc",2);p=u([$("img-loader")],p);const be=`.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}
`;var ve=Object.defineProperty,we=Object.getOwnPropertyDescriptor,P=(t,e,s,i)=>{for(var o=i>1?void 0:i?we(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&ve(e,s,o),o};let O=class extends w(be){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?a`<slot></slot>`:a`<div class="skeleton ${x(this.$c([this.class]))}">${T(this.groups,()=>a`<div class="p"></div>`)}</div>`}};P([c({type:Boolean})],O.prototype,"expect",2);P([c({type:Number})],O.prototype,"num",2);P([c({type:String})],O.prototype,"class",2);O=P([$("loading-skeleton")],O);const $e=`.item{min-height:11rem}
`;var ke=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,_=(t,e,s,i)=>{for(var o=i>1?void 0:i?xe(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&ke(e,s,o),o};let v=class extends z(w($e)){constructor(){super(...arguments),this.item={},this.meta={},this.cook=async()=>{this.meta=await ge(this.item),this.cooked=await ee({DOIDName:this.doid,token:this.token})},this.onObserved=()=>{this.cook()},this.goto=()=>{this.cookedUri&&te(`/collection/${this.cookedUri}`)}}get doid(){var e;return(e=this.DOID)==null?void 0:e.doid}get createTime(){return this.item.ctime?new Date(this.item.ctime).toLocaleString():""}get token(){var i;const{tokenID:e,sequence:s}=this.item;return{name:(i=this.meta)==null?void 0:i.name,tokenID:e,sequence:s}}get cookedName(){var e,s;return(s=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:s.val}get cookedUri(){var e,s;return(s=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:s.uri}get tokenName(){var e,s;return(s=(e=this.cooked)==null?void 0:e.parsed)==null?void 0:s.val}connectedCallback(){super.connectedCallback()}render(){var e,s,i;return a`<div class="item p-4"><div class="font-medium"><loading-skeleton .expect="${this.tokenName}"><dui-link class="uri" href="${`/collection/${this.cookedUri}`}">${this.tokenName}</dui-link></loading-skeleton></div><div class="flex gap-4 py-4"><img-loader class="shrink-0 w-24 h-24" .src="${(e=this.meta)==null?void 0:e.image}" loading="lazy"></img-loader><div><loading-skeleton .expect="${this.meta.name}" num="3"><div class="mb-2 flex items-center"><b class="inline-block text-white rounded py-0.5 px-1 text-xs mr-1.5 ${x({"bg-green-600":!!this.meta.sync,"bg-gray-500":!this.meta.sync})}">${this.meta.sync?"Verified":"Unverified"}</b><dui-link class="text-base" href="${`/collection/${this.cookedUri}`}">${this.meta.name}<i class="mdi mdi-ethereum ml-1"></i></dui-link></div><p class="break-words break-all text-xs lg_text-sm text-gray-500">${(s=this.meta)==null?void 0:s.description}</p></loading-skeleton></div></div><div class="text-xs">Minted on ${this.createTime}, Owned by ${y((i=this.item.doids)==null?void 0:i.length,()=>{var o,r;return a`${(r=(o=this.item.doids)==null?void 0:o.at(0))==null?void 0:r.name}.doid`},()=>a`<dui-address .address="${this.item.owner}"></dui-address>`)}</div></div>`}};_([c()],v.prototype,"DOID",2);_([c()],v.prototype,"item",2);_([d()],v.prototype,"cooked",2);_([d()],v.prototype,"meta",2);v=_([$("doid-coll-item")],v);const Oe=`:host::part(inner){display:flex;height:2rem;width:100%;align-items:center;justify-content:center}@media (min-width: 1024px){:host::part(inner){height:2.5rem}}
`;var _e=Object.defineProperty,De=Object.getOwnPropertyDescriptor,f=(t,e,s,i)=>{for(var o=i>1?void 0:i?De(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&_e(e,s,o),o};let g=class extends z(w(Oe),{persistent:!0}){constructor(){super(...arguments),this.pageSize=5,this.page=1,this.mode="scroll",this.pending=!1,this.firstLoad=!0,this.empty=!1,this.nomore=!1,this.class="",this.onObserved=()=>{this.scrollMode&&this.loadmore()}}get canLoad(){return!this.pending&&!this.nomore&&!this.empty&&!this.firstLoad}get scrollMode(){return this.mode==="scroll"}loadmore(){if(!this.canLoad)return;const{pageSize:t,page:e,mode:s}=this;this.emit("loadmore",{pageSize:t,page:e,mode:s})}connectedCallback(){super.connectedCallback()}render(){return a`<div class="dui-pagination w-full flex justify-center items-center mt-4 ${x(this.$c([{nomore:this.nomore,"pointer-events-none":!this.canLoad},this.class]))}"><div part="inner" @click="${this.loadmore}">${y(this.empty,()=>a`<slot name="empty"></slot>`,()=>a`${y(this.nomore,()=>a`<slot name="nomore"></slot>`,()=>a`${y(this.pending,()=>a`<slot name="loading"><loading-icon type="block"></loading-icon></slot>`,()=>a`${y(!this.scrollMode&&!this.firstLoad,()=>a`<slot><dui-link>Load more</dui-link></slot>`)}`)}`)}`)}</div></div>`}};f([c({type:Number})],g.prototype,"pageSize",2);f([c({type:Number})],g.prototype,"page",2);f([c()],g.prototype,"mode",2);f([c()],g.prototype,"pending",2);f([c({type:Boolean})],g.prototype,"firstLoad",2);f([c({type:Boolean})],g.prototype,"empty",2);f([c({type:Boolean})],g.prototype,"nomore",2);f([c()],g.prototype,"class",2);g=f([$("dui-pagination")],g);const Ce="";var Le=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,b=(t,e,s,i)=>{for(var o=i>1?void 0:i?Pe(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(o=(i?n(e,s,o):n(o))||o);return i&&o&&Le(e,s,o),o};let m=class extends w(Ce){constructor(){super(...arguments),this.pending=!1,this.err="",this.ts=0,this.collections=[],this.nomore=!1,this.page=1,this.pageSize=5,this.loadmore=()=>{this.page++,this.getCollections()}}get doid(){var t;return(t=this.DOID)==null?void 0:t.doid}get empty(){return!this.err&&!!this.doid&&!!this.ts&&!this.collections.length}get pagination(){return{page:this.page,pageSize:this.pageSize}}async getCollections(){if(this.pending)return;const{owner:t=""}=await se(this.doid);if(t){this.pending=!0,this.err="";try{const e=await B({minter:t,doid:this.doid},this.pagination);this.collections.push(...e),this.nomore=e.length<this.pageSize}catch(e){this.err=e.message||e}finally{this.ts++,this.pending=!1}}}connectedCallback(){super.connectedCallback(),this.getCollections()}render(){return a`<div class="doid-collections">${y(this.err,()=>a`${this.err}`)} ${y(this.collections.length,()=>a`<div class="grid gap-4">${T(this.collections,t=>a`${ie(t,a`<div class="bg-gray-100 mb-1 break-words break-all rounded-md"><doid-coll-item .DOID="${this.DOID}" .item="${t}"></doid-coll-item></div>`)}`)}</div>`)} ${y(!this.err,()=>a`<dui-pagination .pending="${this.pending}" .nomore="${this.nomore}" .firstLoad="${!this.ts}" .empty="${this.empty}" .pageSize="${this.pageSize}" .page="${this.page}" @loadmore="${this.loadmore}"><span slot="empty">No collection yet.</span></dui-pagination>`)}</div>`}};b([c()],m.prototype,"DOID",2);b([d()],m.prototype,"pending",2);b([d()],m.prototype,"err",2);b([d()],m.prototype,"ts",2);b([d()],m.prototype,"collections",2);b([d()],m.prototype,"nomore",2);b([d()],m.prototype,"page",2);b([d()],m.prototype,"pageSize",2);m=b([$("doid-collections")],m);export{de as a,ze as b,ge as g,je as q};
