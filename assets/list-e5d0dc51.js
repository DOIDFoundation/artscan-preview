import{w as Y,Z as A,a as H,b as W,c as ee,T as v,N as te,i as N,u as S,d as se,s as Z,h as j,e as I,f as R,D as ie,g as oe,n as re}from"./index-6e7ac18c.js";import{y as a,m as l,e as $,j as ne,u as ae,k as D,n as f,q as P,l as c,w as Q,d as le}from"./vendor-c36f6596.js";const ce=t=>{const{id:e,tokenURI:i}=t,[o,s]=e?e.toString().split("-"):[t.contract.id,t.tokenID];return{address:o,tokenID:s,ctime:t.createdAt*1e3,tokenURI:i}},de=t=>{const e=ce(t),{owner:{id:i="",doids:o=[]}={}}=t;return Object.assign(e,{owner:i,doids:o.map(s=>({...s,name:Y(s.name)}))})},Ue=async t=>{const e=t.toLowerCase();let i=0,o=0;if(t!=A){const s=await H("scan",`{
        doids(where:{address:"${e}"}){address {id totalTokensMinted totalTokenHolders}}
      }`),{address:{totalTokenHolders:r,totalTokensMinted:n}}=s.doids[0]||{};i=r,o=n}return{ownerNum:i,mintNum:o}},F=async(t,e={pageSize:5,page:1})=>{let{minter:i,doid:o,tokenID:s}=t;if(!i||i==A)return[];i=i.toLowerCase();const{tokens:r=[]}=await H("scan",`{tokens(${W(e)} where:{${ee({minter:i,tokenID:s})}} orderBy:createdAt orderDirection:desc){
        id tokenURI createdAt owner { id doids { name }
      }}}`)||{};return r.map(n=>Object.assign(de(n),{minter:i,doid:o}))},Te=async t=>(await F(t))[0];var he=Object.defineProperty,pe=Object.getOwnPropertyDescriptor,G=(t,e,i,o)=>{for(var s=o>1?void 0:o?pe(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&he(e,i,s),s};let U=class extends v(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return a`<div class="block mx-auto my-8 text-center text-xl"><i class="mdi mdi-loading mx-1"></i></div>`;default:return a`<i class="mdi mdi-loading mr-1"></i> Loading...`}}};G([l({type:String})],U.prototype,"type",2);U=G([$("loading-icon")],U);const M=(t,{persistent:e=!1,rootMargin:i="0px"}={})=>class extends t{constructor(){super(...arguments),this.onObserved=()=>{},this.unobserve=()=>{var o;return this.observe$&&((o=this.observer)==null?void 0:o.unobserve(this.observe$))},this.observe=()=>{this.observer||(this.observe$||(this.observe$=this.$(":first-child")))&&(this.observer=new IntersectionObserver(o=>{o[0].intersectionRatio<=0||(this.onObserved(),e||this.unobserve())},{rootMargin:i}),this.observer.observe(this.observe$))}}firstUpdated(){this.observe()}connectedCallback(){this.unobserve(),super.connectedCallback()}},ge={url:{"0x1":"https://opensea.io/assets/ethereum","0xaa36a7":"https://testnets.opensea.io/assets/sepolia","0x5":"https://testnets.opensea.io/assets/goerli"},api:{"0x1":"https://api.opensea.io/api/v1/asset","0xaa36a7":"https://testnets-api.opensea.io/api/v1/asset","0x5":"https://testnets-api.opensea.io/api/v1/asset"}},E=t=>ge[t][te.chainId],T=t=>{var k;const{background_color:e,owner:i="",external_link:o,asset_contract:s,collection:r}=t,n=t.image_url||t.image||"",z=t.name||(r==null?void 0:r.name),h=I(t.image_preview_url||t.image_thumbnail_url||n);return{name:z,description:t.description||(r==null?void 0:r.description),image:h,raw:I(t.image_original_url||n),creator:(k=t.creator)==null?void 0:k.address,owner:i,external_link:o,background_color:e}},L={store:sessionStorage,withoutEnv:!0,ttl:864e5};let x=0;const B=async(t,e=1024)=>{let i={};if(x)return await Z(50),await B(t);x=R();try{i=await j.get(t),setTimeout(()=>{x=0},Math.max(R()-x,e))}catch(o){x=0}return i},J=async({address:t="",tokenID:e=""}={},i=!0)=>{let o;const s=await S(`meta.${t}.${e}`,L);if(o=await s.get(),!o)try{o=T(await B(`${E("api")}/${t}/${e}/`)),o.name&&o.image?s.set(o):o.image||(await B(`${E("api")}/${t}/${e}/?force_update=true`),i&&(await Z(1e4),o=await J({address:t,tokenID:e},!1)))}catch(r){}return o!=null?o:{}},q=async(t="")=>{let e;if(!t)return{};N(t)&&(e=T(await j.get(t)));const i=await S(`meta.${t}`,L);if(e||(e=await i.get()),!e)try{e=T(await j.get(I(t))),e.name&&e.image&&i.set(e)}catch(o){}return e!=null?e:{}},me=async t=>{let e;const{tokenURI:i,address:o,tokenID:s}=t;return N(i)&&(e=await q(i)),!e&&i&&(e=await(await S(`meta.${i}`,L)).get()),e||(e=await(await S(`meta.${o}.${s}`,L)).get()),!e&&o&&s&&(e=await J(t)),!e&&i&&(e=await q(i)),e&&(t.meta=e,se(t)),e!=null?e:{}},ue=async(t,{maxW:e=400}={})=>new Promise(i=>{if(!t)return i("");const o=sessionStorage.getItem(`blob.${t}`);if(o)return i(o);const s=new Image;s.src=t,s.crossOrigin="anonymous",s.onload=async()=>{let[h,p]=[s.width,s.height],[k,K,V,X]=[0,0,h,p];h>e&&(p=e*(p/h),h=e),p>e&&(h=e*(h/p),p=e),s.height/s.width,r.width=h,r.height=p,n.drawImage(s,k,K,V,X,0,0,h,p),z()};const r=document.createElement("canvas"),n=r.getContext("2d"),z=()=>{r.toBlob(h=>{const p=URL.createObjectURL(h);sessionStorage.setItem(`blob.${t}`,p),i(p)},"image/png",1)}}),fe=`i{position:relative;display:inline-flex;height:100%;width:100%;align-items:center;justify-content:center;overflow:hidden}i.empty,i.err,i:not(.loaded){background:linear-gradient(-45deg,rgba(238,201,121) 8%,rgb(187,131,68) 36%,rgba(238,201,121) 66%) 0% 0% / 2400px;animation:silk 4s linear infinite}i.err img{visibility:hidden}i img{height:auto;max-height:100%;width:auto;max-width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-object-fit:contain;object-fit:contain}@keyframes silk{0%{background-position:-2400px 0}to{background-position:2400px 0}}
`;var ye=Object.defineProperty,be=Object.getOwnPropertyDescriptor,g=(t,e,i,o)=>{for(var s=o>1?void 0:o?be(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&ye(e,i,s),s};const we=[48,64,128,256,384,512,640,750,828,1080,1200,1920,2048,3840];let d=class extends M(v(fe)){constructor(){super(...arguments),this.el$=ne(),this.src="",this.loaded=!1,this.stop=!1,this.loading="eager",this.sizes=void 0,this.w="100%",this.firstLoaded=this.loaded,this.imgLoaded=this.loaded,this.err=!1,this.show=!1,this.blobSrc="",this.onLoad=()=>{this.emit("loaded",this.imgLoaded=this.firstLoaded=!0)},this.onError=()=>{this.err=!1},this.onObserved=()=>{var t,e;this.w=((e=(t=this.el$.value)==null?void 0:t.getBoundingClientRect().width)!=null?e:"400")+"",this.show=!0}}get lazy(){return this.loading==="lazy"}get isInstantSrc(){return N(this.src)}get isResizableSrc(){return/\?(w|width)=/.test(this.src)}get requireComporess(){return!this.isResizableSrc&&!this.isInstantSrc&&!this.blobSrc}get uri(){if(!(this.err||!this.show))return this.requireComporess?this.blobSrc:this.src}get empty(){return!(this.src||this.blobSrc)||!(this.uri||this.uriset)}get uriset(){if(this.err||!this.show||!this.isResizableSrc)return;const{origin:t,pathname:e}=new URL(this.src);return we.map(i=>`${[t+e]}?auto=format&w=${i}&width=${i} ${i}w`).join(",")}get autoSizes(){return this.sizes?this.sizes:`(max-width: 768px) ${this.w}px, ${this.w}px`}shouldUpdate(t){return t.has("src")&&this.requireComporess&&ue(this.src).then(e=>this.blobSrc=e),!0}connectedCallback(){super.connectedCallback(),this.loading==="eager"&&this.onObserved()}render(){return a`<i ${ae(this.el$)} class="${D({loaded:this.firstLoaded,err:this.err,empty:this.empty,stop:this.stop})}">${f(this.isResizableSrc?this.uriset:this.uri,()=>a`<img class="${D({invisible:!this.firstLoaded,"opacity-0":!this.firstLoaded})}" src="${P(this.uri)}" srcset="${P(this.uriset)}" sizes="${P(this.autoSizes)}" @load="${this.onLoad}" @error="${this.onError}">`)}</i>`}};g([l({type:String})],d.prototype,"src",2);g([l({type:Boolean})],d.prototype,"loaded",2);g([l({type:Boolean})],d.prototype,"stop",2);g([l({type:String})],d.prototype,"loading",2);g([l({type:String})],d.prototype,"sizes",2);g([c()],d.prototype,"w",2);g([c()],d.prototype,"firstLoaded",2);g([c()],d.prototype,"imgLoaded",2);g([c()],d.prototype,"err",2);g([c()],d.prototype,"show",2);g([c()],d.prototype,"blobSrc",2);d=g([$("img-loader")],d);const ve=`.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}
`;var $e=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,C=(t,e,i,o)=>{for(var s=o>1?void 0:o?xe(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&$e(e,i,s),s};let O=class extends v(ve){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?a`<slot></slot>`:a`<div class="skeleton ${D(this.$c([this.class]))}">${Q(this.groups,()=>a`<div class="p"></div>`)}</div>`}};C([l({type:Boolean})],O.prototype,"expect",2);C([l({type:Number})],O.prototype,"num",2);C([l({type:String})],O.prototype,"class",2);O=C([$("loading-skeleton")],O);const Oe=`.item{min-height:11rem}
`;var _e=Object.defineProperty,ke=Object.getOwnPropertyDescriptor,_=(t,e,i,o)=>{for(var s=o>1?void 0:o?ke(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&_e(e,i,s),s};let w=class extends M(v(Oe)){constructor(){super(...arguments),this.item={},this.meta={},this.cook=async()=>{this.meta=await me(this.item),this.cooked=await ie({DOIDName:this.doid,token:this.token})},this.onObserved=()=>{this.cook()},this.goto=()=>{this.cookedUri&&oe(`/collection/${this.cookedUri}`)}}get doid(){var t;return(t=this.DOID)==null?void 0:t.doid}get createTime(){return this.item.ctime?new Date(this.item.ctime).toLocaleString():""}get token(){var e;const{tokenID:t}=this.item;return{name:(e=this.meta)==null?void 0:e.name,tokenID:t}}get cookedName(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.val}get cookedUri(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.uri}get tokenName(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.val}connectedCallback(){super.connectedCallback()}render(){var t,e,i;return a`<div class="item p-4"><div class="font-medium"><loading-skeleton .expect="${this.meta.name}"><dui-link class="uri" href="${`/collection/${this.cookedUri}`}">${this.cookedUri}</dui-link></loading-skeleton></div><div class="flex gap-4 py-4"><img-loader class="shrink-0 w-24 h-24" .src="${(t=this.meta)==null?void 0:t.image}" loading="lazy"></img-loader><div><loading-skeleton .expect="${this.meta.name}" num="3"><div class="mb-2 flex items-center justify-between"><dui-link class="text-base" href="${`/collection/${this.cookedUri}`}">${this.meta.name}</dui-link><i class="mdi mdi-ethereum ml-1"></i></div><p class="break-words break-all text-xs lg_text-sm text-gray-500">${(e=this.meta)==null?void 0:e.description}</p></loading-skeleton></div></div><div class="flex justify-between"><div class="text-xs">Minted on ${this.createTime}</div><div class="text-xs">Owned by ${f((i=this.item.doids)==null?void 0:i.length,()=>{var o,s;return a`${(s=(o=this.item.doids)==null?void 0:o.at(0))==null?void 0:s.name}`},()=>a`<dui-address .address="${this.item.owner}"></dui-address>`)}</div></div></div>`}};_([l()],w.prototype,"DOID",2);_([l()],w.prototype,"item",2);_([c()],w.prototype,"cooked",2);_([c()],w.prototype,"meta",2);w=_([$("doid-coll-item")],w);const Se=`:host::part(inner){display:flex;height:2rem;width:100%;align-items:center;justify-content:center}@media (min-width: 1024px){:host::part(inner){height:2.5rem}}
`;var De=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,y=(t,e,i,o)=>{for(var s=o>1?void 0:o?Le(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&De(e,i,s),s};let m=class extends M(v(Se),{persistent:!0,rootMargin:"30px"}){constructor(){super(...arguments),this.pageSize=5,this.page=1,this.mode="scroll",this.pending=!1,this.firstLoad=!0,this.empty=!1,this.nomore=!1,this.class="",this.onObserved=()=>{this.scrollMode&&this.loadmore()}}get canLoad(){return!this.pending&&!this.nomore&&!this.empty&&!this.firstLoad}get scrollMode(){return this.mode==="scroll"}loadmore(){if(!this.canLoad)return;const{pageSize:t,page:e,mode:i}=this;this.emit("loadmore",{pageSize:t,page:e,mode:i})}connectedCallback(){super.connectedCallback()}render(){return a`<div class="dui-pagination w-full flex justify-center items-center mt-4 ${D(this.$c([{nomore:this.nomore,"pointer-events-none":!this.canLoad},this.class]))}"><div part="inner" @click="${this.loadmore}">${f(this.empty,()=>a`<slot name="empty"></slot>`,()=>a`${f(this.nomore,()=>a`<slot name="nomore"></slot>`,()=>a`${f(this.pending,()=>a`<slot name="loading"><loading-icon type="block"></loading-icon></slot>`,()=>a`${f(!this.scrollMode&&!this.firstLoad,()=>a`<slot><dui-link>Load more</dui-link></slot>`)}`)}`)}`)}</div></div>`}};y([l({type:Number})],m.prototype,"pageSize",2);y([l({type:Number})],m.prototype,"page",2);y([l()],m.prototype,"mode",2);y([l()],m.prototype,"pending",2);y([l({type:Boolean})],m.prototype,"firstLoad",2);y([l({type:Boolean})],m.prototype,"empty",2);y([l({type:Boolean})],m.prototype,"nomore",2);y([l()],m.prototype,"class",2);m=y([$("dui-pagination")],m);const Ce="";var ze=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,b=(t,e,i,o)=>{for(var s=o>1?void 0:o?Pe(e,i):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&ze(e,i,s),s};let u=class extends v(Ce){constructor(){super(...arguments),this.pending=!1,this.err="",this.ts=0,this.collections=[],this.nomore=!1,this.page=1,this.pageSize=5,this.loadmore=()=>{this.page++,this.getCollections()}}get doid(){var t;return(t=this.DOID)==null?void 0:t.doid}get empty(){return!this.err&&!!this.doid&&!!this.ts&&!this.collections.length}get pagination(){return{page:this.page,pageSize:this.pageSize}}async getCollections(){if(this.pending)return;const{owner:t=""}=await re(this.doid);if(t){this.pending=!0,this.err="";try{const e=await F({minter:t,doid:this.doid},this.pagination);this.collections.push(...e),this.nomore=e.length<this.pageSize}catch(e){this.err=e.message||e}finally{this.ts++,this.pending=!1}}}connectedCallback(){super.connectedCallback(),this.getCollections()}render(){return a`<div class="doid-collections">${f(this.err,()=>a`${this.err}`)} ${f(this.collections.length,()=>a`<div class="grid gap-4">${Q(this.collections,t=>a`${le(t,a`<div class="bg-gray-100 break-words break-all rounded-md"><doid-coll-item .DOID="${this.DOID}" .item="${t}"></doid-coll-item></div>`)}`)}</div>`)} ${f(!this.err,()=>a`<dui-pagination .pending="${this.pending}" .nomore="${this.nomore}" .firstLoad="${!this.ts}" .empty="${this.empty}" .pageSize="${this.pageSize}" .page="${this.page}" @loadmore="${this.loadmore}"><span slot="empty">No collection yet.</span></dui-pagination>`)}</div>`}};b([l()],u.prototype,"DOID",2);b([c()],u.prototype,"pending",2);b([c()],u.prototype,"err",2);b([c()],u.prototype,"ts",2);b([c()],u.prototype,"collections",2);b([c()],u.prototype,"nomore",2);b([c()],u.prototype,"page",2);b([c()],u.prototype,"pageSize",2);u=b([$("doid-collections")],u);export{E as a,Te as b,me as g,Ue as q};
