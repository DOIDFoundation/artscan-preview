import{w as K,Z as R,a as E,b as V,c as X,T as v,N as Y,i as N,u as D,h as P,d as I,s as W,e as T,f as ee,D as te,g as se,n as ie}from"./index-2a6cb313.js";import{y as a,m as l,e as $,j as oe,u as re,k as S,n as f,q as z,l as c,w as q,d as ne}from"./vendor-c36f6596.js";const ae=t=>{const{id:e,tokenURI:s}=t,[o,i]=e?e.toString().split("-"):[t.contract.id,t.tokenID];return{address:o,tokenID:i,ctime:t.createdAt*1e3,tokenURI:s}},le=t=>{const e=ae(t),{owner:{id:s="",doids:o=[]}={}}=t;return Object.assign(e,{owner:s,doids:o.map(i=>({...i,name:K(i.name)}))})},Ue=async t=>{const e=t.toLowerCase();let s=0,o=0;if(t!=R){const i=await E("scan",`{
        owner(id:"${e}") {mints:totalTokensMinted,holders:totalTokenHolders}
      }`),{holders:r=[],mints:n=[]}=i.owner;s=r,o=n}return{ownerNum:s,mintNum:o}},A=async(t,e={pageSize:5,page:1})=>{let{minter:s,doid:o,tokenID:i}=t;if(!s||s==R)return[];s=s.toLowerCase();const{tokens:r=[]}=await E("scan",`{tokens(${V(e)} where:{${X({minter:s,tokenID:i})}} orderBy:createdAt orderDirection:desc){
        id tokenURI createdAt owner { id doids { name }
      }}}`)||{};return r.map(n=>Object.assign(le(n),{minter:s,doid:o}))},Ne=async t=>(await A(t))[0];var ce=Object.defineProperty,de=Object.getOwnPropertyDescriptor,H=(t,e,s,o)=>{for(var i=o>1?void 0:o?de(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&ce(e,s,i),i};let j=class extends v(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return a`<div class="block mx-auto my-8 text-center text-base"><i class="mdi mdi-loading mx-1"></i></div>`;default:return a`<i class="mdi mdi-loading mr-1"></i> Loading...`}}};H([l({type:String})],j.prototype,"type",2);j=H([$("loading-icon")],j);const B=(t,{persistent:e=!1,rootMargin:s="0px"}={})=>class extends t{constructor(){super(...arguments),this.onObserved=()=>{},this.unobserve=()=>{var o;return this.observe$&&((o=this.observer)==null?void 0:o.unobserve(this.observe$))},this.observe=()=>{this.observer||(this.observe$||(this.observe$=this.$(":first-child")))&&(this.observer=new IntersectionObserver(o=>{o[0].intersectionRatio<=0||(this.onObserved(),e||this.unobserve())},{rootMargin:s}),this.observer.observe(this.observe$))}}firstUpdated(){this.observe()}connectedCallback(){this.unobserve(),super.connectedCallback()}},he={url:{"0x1":"https://opensea.io/assets/ethereum","0xaa36a7":"https://testnets.opensea.io/assets/sepolia","0x5":"https://testnets.opensea.io/assets/goerli"},api:{"0x1":"https://api.opensea.io/api/v1/asset","0xaa36a7":"https://testnets-api.opensea.io/api/v1/asset","0x5":"https://testnets-api.opensea.io/api/v1/asset"}},pe=t=>he[t][Y.chainId],U=t=>{var d;const{background_color:e,owner:s="",external_link:o,asset_contract:i,collection:r}=t,n=t.image_url||t.image||"",_=t.name||(r==null?void 0:r.name);return{name:_,description:t.description||(r==null?void 0:r.description),slug:W(_),image:I(t.image_preview_url||t.image_thumbnail_url||n),raw:I(t.image_original_url||n),creator:(d=t.creator)==null?void 0:d.address,owner:s,external_link:o,background_color:e}},L={store:sessionStorage,withoutEnv:!0,ttl:864e5};let x=0;const Z=async(t,e=1024)=>{let s={};if(x)return await ee(50),await Z(t);x=T();try{s=await P.get(t),setTimeout(()=>{x=0},Math.max(T()-x,e))}catch(o){x=0}return s},ge=async({address:t="",tokenID:e=""}={})=>{let s;const o=await D(`meta.${t}.${e}`,L);if(s=await o.get(),!s)try{s=U(await Z(`${pe("api")}/${t}/${e}/`)),s&&o.set(s)}catch(i){}return s!=null?s:{}},M=async(t="")=>{let e;if(!t)return{};N(t)&&(e=U(await P.get(t)));const s=await D(`meta.${t}`,L);if(e||(e=await s.get()),!e)try{e=U(await P.get(I(t))),e&&s.set(e)}catch(o){}return e!=null?e:{}},me=async t=>{let e;const{tokenURI:s,address:o,tokenID:i,doid:r,minter:n}=t;return N(s)&&(e=await M(s)),!e&&s&&(e=await(await D(`meta.${s}`,L)).get()),e||(e=await(await D(`meta.${o}.${i}`,L)).get()),!e&&o&&i&&(e=await ge(t)),!e&&s&&(e=await M(s)),e!=null?e:{}},ue=async(t,{maxW:e=400}={})=>new Promise(s=>{if(!t)return s("");const o=sessionStorage.getItem(`blob.${t}`);if(o)return s(o);const i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=async()=>{let[g,d]=[i.width,i.height],[Q,F,G,J]=[0,0,g,d];g>e&&(d=e*(d/g),g=e),d>e&&(g=e*(g/d),d=e),i.height/i.width,r.width=g,r.height=d,n.drawImage(i,Q,F,G,J,0,0,g,d),_()};const r=document.createElement("canvas"),n=r.getContext("2d"),_=()=>{r.toBlob(g=>{const d=URL.createObjectURL(g);sessionStorage.setItem(`blob.${t}`,d),s(d)},"image/png",1)}}),fe=`i{position:relative;display:inline-flex;height:100%;width:100%;align-items:center;justify-content:center;overflow:hidden}i.empty,i.err,i:not(.loaded){background:linear-gradient(-45deg,rgba(238,201,121) 8%,rgb(187,131,68) 36%,rgba(238,201,121) 66%) 0% 0% / 2400px;animation:silk 4s linear infinite}i.err img{visibility:hidden}i img{height:auto;max-height:100%;width:auto;max-width:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-object-fit:contain;object-fit:contain}@keyframes silk{0%{background-position:-2400px 0}to{background-position:2400px 0}}
`;var ye=Object.defineProperty,be=Object.getOwnPropertyDescriptor,p=(t,e,s,o)=>{for(var i=o>1?void 0:o?be(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&ye(e,s,i),i};const we=[48,64,128,256,384,512,640,750,828,1080,1200,1920,2048,3840];let h=class extends B(v(fe)){constructor(){super(...arguments),this.el$=oe(),this.src="",this.loaded=!1,this.stop=!1,this.loading="eager",this.sizes=void 0,this.w="100%",this.firstLoaded=this.loaded,this.imgLoaded=this.loaded,this.err=!1,this.show=!1,this.blobSrc="",this.onLoad=()=>{this.emit("loaded",this.imgLoaded=this.firstLoaded=!0)},this.onError=()=>{this.err=!1},this.onObserved=()=>{var t,e;this.w=((e=(t=this.el$.value)==null?void 0:t.getBoundingClientRect().width)!=null?e:"400")+"",this.show=!0}}get lazy(){return this.loading==="lazy"}get isInstantSrc(){return N(this.src)}get isResizableSrc(){return/\?(w|width)=/.test(this.src)}get requireComporess(){return!this.isResizableSrc&&!this.isInstantSrc&&!this.blobSrc}get uri(){if(!(this.err||!this.show))return this.requireComporess?this.blobSrc:this.src}get empty(){return!(this.src||this.blobSrc)||!(this.uri||this.uriset)}get uriset(){if(this.err||!this.show||!this.isResizableSrc)return;const{origin:t,pathname:e}=new URL(this.src);return we.map(s=>`${[t+e]}?auto=format&w=${s}&width=${s} ${s}w`).join(",")}get autoSizes(){return this.sizes?this.sizes:`(max-width: 768px) ${this.w}px, ${this.w}px`}shouldUpdate(t){return t.has("src")&&this.requireComporess&&ue(this.src).then(e=>this.blobSrc=e),!0}connectedCallback(){super.connectedCallback(),this.loading==="eager"&&this.onObserved()}render(){return a`<i ${re(this.el$)} class="${S({loaded:this.firstLoaded,err:this.err,empty:this.empty,stop:this.stop})}">${f(this.isResizableSrc?this.uriset:this.uri,()=>a`<img class="${S({invisible:!this.firstLoaded,"opacity-0":!this.firstLoaded})}" src="${z(this.uri)}" srcset="${z(this.uriset)}" sizes="${z(this.autoSizes)}" @load="${this.onLoad}" @error="${this.onError}">`)}</i>`}};p([l({type:String})],h.prototype,"src",2);p([l({type:Boolean})],h.prototype,"loaded",2);p([l({type:Boolean})],h.prototype,"stop",2);p([l({type:String})],h.prototype,"loading",2);p([l({type:String})],h.prototype,"sizes",2);p([c()],h.prototype,"w",2);p([c()],h.prototype,"firstLoaded",2);p([c()],h.prototype,"imgLoaded",2);p([c()],h.prototype,"err",2);p([c()],h.prototype,"show",2);p([c()],h.prototype,"blobSrc",2);h=p([$("img-loader")],h);const ve=`.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}
`;var $e=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,C=(t,e,s,o)=>{for(var i=o>1?void 0:o?xe(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&$e(e,s,i),i};let O=class extends v(ve){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?a`<slot></slot>`:a`<div class="skeleton ${S(this.$c([this.class]))}">${q(this.groups,()=>a`<div class="p"></div>`)}</div>`}};C([l({type:Boolean})],O.prototype,"expect",2);C([l({type:Number})],O.prototype,"num",2);C([l({type:String})],O.prototype,"class",2);O=C([$("loading-skeleton")],O);const Oe=`.item{min-height:11rem}
`;var ke=Object.defineProperty,_e=Object.getOwnPropertyDescriptor,k=(t,e,s,o)=>{for(var i=o>1?void 0:o?_e(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&ke(e,s,i),i};let w=class extends B(v(Oe)){constructor(){super(...arguments),this.item={},this.meta={},this.cook=async()=>{this.meta=await me(this.item),this.cooked=await te({DOIDName:this.doid,token:this.token})},this.onObserved=()=>{this.cook()},this.goto=()=>{this.cookedUri&&se(`/collection/${this.cookedUri}`)}}get doid(){var t;return(t=this.DOID)==null?void 0:t.doid}get createTime(){return this.item.ctime?new Date(this.item.ctime).toLocaleString():""}get token(){var e;const{tokenID:t}=this.item;return{name:(e=this.meta)==null?void 0:e.name,tokenID:t}}get cookedName(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.val}get cookedUri(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.uri}get tokenName(){var t,e;return(e=(t=this.cooked)==null?void 0:t.parsed)==null?void 0:e.val}connectedCallback(){super.connectedCallback()}render(){var t,e,s;return a`<div class="item p-4"><div class="font-medium"><loading-skeleton .expect="${this.tokenName}"><dui-link class="uri" href="${`/collection/${this.cookedUri}`}">${this.cookedUri}</dui-link></loading-skeleton></div><div class="flex gap-4 py-4"><img-loader class="shrink-0 w-24 h-24" .src="${(t=this.meta)==null?void 0:t.image}" loading="lazy"></img-loader><div><loading-skeleton .expect="${this.meta.name}" num="3"><div class="mb-2 flex items-center"><dui-link class="text-base" href="${`/collection/${this.cookedUri}`}">${this.meta.name}<i class="mdi mdi-ethereum ml-1"></i></dui-link></div><p class="break-words break-all text-xs lg_text-sm text-gray-500">${(e=this.meta)==null?void 0:e.description}</p></loading-skeleton></div></div><div class="text-xs">Minted on ${this.createTime}, Owned by ${f((s=this.item.doids)==null?void 0:s.length,()=>{var o,i;return a`${(i=(o=this.item.doids)==null?void 0:o.at(0))==null?void 0:i.name}`},()=>a`<dui-address .address="${this.item.owner}"></dui-address>`)}</div></div>`}};k([l()],w.prototype,"DOID",2);k([l()],w.prototype,"item",2);k([c()],w.prototype,"cooked",2);k([c()],w.prototype,"meta",2);w=k([$("doid-coll-item")],w);const De=`:host::part(inner){display:flex;height:2rem;width:100%;align-items:center;justify-content:center}@media (min-width: 1024px){:host::part(inner){height:2.5rem}}
`;var Se=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,y=(t,e,s,o)=>{for(var i=o>1?void 0:o?Le(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&Se(e,s,i),i};let m=class extends B(v(De),{persistent:!0,rootMargin:"30px"}){constructor(){super(...arguments),this.pageSize=5,this.page=1,this.mode="scroll",this.pending=!1,this.firstLoad=!0,this.empty=!1,this.nomore=!1,this.class="",this.onObserved=()=>{this.scrollMode&&this.loadmore()}}get canLoad(){return!this.pending&&!this.nomore&&!this.empty&&!this.firstLoad}get scrollMode(){return this.mode==="scroll"}loadmore(){if(!this.canLoad)return;const{pageSize:t,page:e,mode:s}=this;this.emit("loadmore",{pageSize:t,page:e,mode:s})}connectedCallback(){super.connectedCallback()}render(){return a`<div class="dui-pagination w-full flex justify-center items-center mt-4 ${S(this.$c([{nomore:this.nomore,"pointer-events-none":!this.canLoad},this.class]))}"><div part="inner" @click="${this.loadmore}">${f(this.empty,()=>a`<slot name="empty"></slot>`,()=>a`${f(this.nomore,()=>a`<slot name="nomore"></slot>`,()=>a`${f(this.pending,()=>a`<slot name="loading"><loading-icon type="block"></loading-icon></slot>`,()=>a`${f(!this.scrollMode&&!this.firstLoad,()=>a`<slot><dui-link>Load more</dui-link></slot>`)}`)}`)}`)}</div></div>`}};y([l({type:Number})],m.prototype,"pageSize",2);y([l({type:Number})],m.prototype,"page",2);y([l()],m.prototype,"mode",2);y([l()],m.prototype,"pending",2);y([l({type:Boolean})],m.prototype,"firstLoad",2);y([l({type:Boolean})],m.prototype,"empty",2);y([l({type:Boolean})],m.prototype,"nomore",2);y([l()],m.prototype,"class",2);m=y([$("dui-pagination")],m);const Ce="";var ze=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,b=(t,e,s,o)=>{for(var i=o>1?void 0:o?Pe(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(i=(o?n(e,s,i):n(i))||i);return o&&i&&ze(e,s,i),i};let u=class extends v(Ce){constructor(){super(...arguments),this.pending=!1,this.err="",this.ts=0,this.collections=[],this.nomore=!1,this.page=1,this.pageSize=5,this.loadmore=()=>{this.page++,this.getCollections()}}get doid(){var t;return(t=this.DOID)==null?void 0:t.doid}get empty(){return!this.err&&!!this.doid&&!!this.ts&&!this.collections.length}get pagination(){return{page:this.page,pageSize:this.pageSize}}async getCollections(){if(this.pending)return;const{owner:t=""}=await ie(this.doid);if(t){this.pending=!0,this.err="";try{const e=await A({minter:t,doid:this.doid},this.pagination);this.collections.push(...e),this.nomore=e.length<this.pageSize}catch(e){this.err=e.message||e}finally{this.ts++,this.pending=!1}}}connectedCallback(){super.connectedCallback(),this.getCollections()}render(){return a`<div class="doid-collections">${f(this.err,()=>a`${this.err}`)} ${f(this.collections.length,()=>a`<div class="grid gap-4">${q(this.collections,t=>a`${ne(t,a`<div class="bg-gray-100 break-words break-all rounded-md"><doid-coll-item .DOID="${this.DOID}" .item="${t}"></doid-coll-item></div>`)}`)}</div>`)} ${f(!this.err,()=>a`<dui-pagination .pending="${this.pending}" .nomore="${this.nomore}" .firstLoad="${!this.ts}" .empty="${this.empty}" .pageSize="${this.pageSize}" .page="${this.page}" @loadmore="${this.loadmore}"><span slot="empty">No collection yet.</span></dui-pagination>`)}</div>`}};b([l()],u.prototype,"DOID",2);b([c()],u.prototype,"pending",2);b([c()],u.prototype,"err",2);b([c()],u.prototype,"ts",2);b([c()],u.prototype,"collections",2);b([c()],u.prototype,"nomore",2);b([c()],u.prototype,"page",2);b([c()],u.prototype,"pageSize",2);u=b([$("doid-collections")],u);export{pe as a,Ne as b,me as g,Ue as q};
